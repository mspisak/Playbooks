---
- hosts: semaphore
gather_facts: true
vars:
username: semaphore
homedir: /opt/semaphore
logdir: /var/log/semaphore
sudo: true
tasks:
- user: name={{ username }}
- shell: bower install --allow-root && npm install > {{ homedir }}/somelog.txt
args:
chdir: "{{ homedir }}"
creates: "{{ homedir }}/somelog.txt"
- shell: chown -R {{ username }} {{ homedir }}
# copy over the example credentials
- shell: cp -p {{ homedir }}/lib/credentials.default.json {{ homedir }}/lib/credentials.json
# Setup runit and logging to /var/log/runit_semaphore
- file: path={{ homedir }}/runit_semaphore/log state=directory
- file: path={{ logdir }} state=directory owner={{ username }}
- copy: src=run_semaphore dest={{ homedir }}/runit_semaphore/run mode=0755
- template: src=run_semaphore_log.j2 dest={{ homedir }}/runit_semaphore/log/run mode=0755
- file: src={{ homedir }}/runit_semaphore dest=/etc/service/runit_semaphore state=link
